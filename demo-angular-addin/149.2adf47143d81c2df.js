"use strict";(self.webpackChunkcustom_template_builder=self.webpackChunkcustom_template_builder||[]).push([[149],{3149:(W,u,a)=>{a.r(u),a.d(u,{HtmlEditorComponent:()=>g,default:()=>Y});var T=a(7217),d=a(4755),r=a(1135),x=a(727),v=a(4128),S=a(9751),$=a(9646),c=a(9300),E=a(3900),m=a(4004),f=a(5698),F=a(590),p=a(5577),y=a(8505),b=a(2550);const M={decisionTemplate:"word-agenda-item-decision.html",taskTemplate:"word-agenda-item-action.html",fileCoverPage:"agendaitem-file-coverpage-meetingbook.html"};var t=a(9523),N=a(3396),w=a(7579),C=a(2340);let Z=(()=>{class o{constructor(){this.loaded=!1,this.loadingFinishedSub$=new w.x,this.loadingFinished$=this.loadingFinishedSub$.asObservable()}initialize(){const e=C.N.monacoBaseUrl;if("object"==typeof window.monaco)return void this.finishLoading();const n=()=>{window.require.config({paths:{vs:`${e}`}}),window.require(["vs/editor/editor.main"],()=>{this.finishLoading()})};if(window.require)n();else{const i=document.createElement("script");i.type="text/javascript",i.src=`${e}/loader.js`,i.addEventListener("load",n),document.body.appendChild(i)}}finishLoading(){this.loaded=!0,this.loadingFinishedSub$.next()}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var A=a(6202);const I=["editorContainer"];function H(o,s){if(1&o&&(t.TgZ(0,"option",16)(1,"div"),t._uU(2),t.qZA()()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(2),t.hij(" ",e," ")}}function j(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",13)(1,"select",14),t.NdJ("change",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.onTemplateSelected(i.target.value))}),t.YNc(2,H,3,2,"option",15),t.ALo(3,"async"),t.qZA()()}if(2&o){const e=t.oxw(2);t.xp6(2),t.Q6J("ngForOf",t.lcZ(3,1,e.templates$))}}function U(o,s){if(1&o&&t._uU(0),2&o){const e=t.oxw().ngIf;t.hij(" ",e," ")}}function O(o,s){if(1&o&&(t.TgZ(0,"div",10),t.YNc(1,j,4,3,"div",11),t.ALo(2,"async"),t.YNc(3,U,1,1,"ng-template",null,12,t.W1O),t.qZA()),2&o){const e=t.MAs(4),n=t.oxw();let i;t.xp6(1),t.Q6J("ngIf",(null==(i=t.lcZ(2,2,n.templates$))?null:i.length)>1)("ngIfElse",e)}}function J(o,s){1&o&&(t.TgZ(0,"div",17),t._uU(1," Saved "),t.qZA())}let g=(()=>{class o{constructor(e,n,i){this.router=e,this.monacoEditorService=n,this.searchService=i,this.showSaved=!1,this.selectedFileName$=new r.X(""),this.updatedTemplatesMap$=new r.X({}),this.containsNestedTemplates=!1,this.componentSub=new x.w0,this.templates$=new r.X([]),this.originalTemplates={},this.monacoEditorService.initialize()}ngAfterViewInit(){const e=this.initMonaco(),n=this.loadTemplateFile();(0,v.D)([e,n]).subscribe(()=>this.subscribeToFileSelectionChange())}subscribeToFileSelectionChange(){const e=this.selectedFileName$.pipe((0,c.h)(n=>n.length>0),(0,E.w)(n=>this.updatedTemplatesMap$.pipe((0,m.U)(i=>i[n])).pipe((0,c.h)(i=>!!i),(0,f.q)(1)))).subscribe(n=>{this._editor.setValue(n)});this.componentSub.add(e)}initMonaco(){return this.monacoEditorService.loaded?this.createMonacoEditor():this.monacoEditorService.loadingFinished$.pipe((0,F.P)(),(0,p.z)(()=>this.createMonacoEditor()))}createMonacoEditor(){return new S.y(e=>{this._editor=monaco.editor.create(this._editorContainer.nativeElement,{language:"html"}),e.next(),e.complete()})}loadTemplateFile(){return this.router.queryParamMap.pipe((0,m.U)(n=>{const i=n.get("data");return(0,b.sW)(i)?.htmlTemplateName})).pipe((0,c.h)(n=>n),(0,f.q)(1),(0,m.U)(n=>n.length>0?n:""),(0,p.z)(n=>(this.templates$.next([n]),this.loadTemplateWithNested(n).pipe((0,y.b)(()=>this.selectedFileName$.next(n))))))}loadTemplateWithNested(e){return this.searchService.loadTemplateFile(e).pipe((0,p.z)(n=>{this.insertTemplateIntoMap(e,n),this.originalTemplates[e]=n;const l=Array.from(n.matchAll(/{{>(.*?)}}/g)).map(h=>M[h[1]]);if(0===l.length)return(0,$.of)(void 0);this.templates$.next([...this.templates$.value,...l]);const Q=l.map(h=>this.loadTemplateWithNested(h));return(0,v.D)(Q)}))}onTemplateSelected(e){this.insertTemplateIntoMap(this.selectedFileName$.value,this._editor.getValue()),this.selectedFileName$.next(e)}saveTemplate(){this.insertTemplateIntoMap(this.selectedFileName$.value,this._editor.getValue()),this.showSaved=!0;const e=function z(o,s){const e={};return Object.keys(o).forEach(i=>{o[i]!==s[i]&&(e[i]=s[i])}),e}(this.originalTemplates,this.updatedTemplatesMap$.value);Office.context.ui.messageParent(JSON.stringify({content:e})),setTimeout(()=>{this.showSaved=!1},3e3)}insertTemplateIntoMap(e,n){const i=this.updatedTemplatesMap$.value;i[e]=n,this.updatedTemplatesMap$.next(i)}ngOnDestroy(){this.componentSub.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(N.gz),t.Y36(Z),t.Y36(A.o))},o.\u0275cmp=t.Xpm({type:o,selectors:[["ds-html-editor"]],viewQuery:function(e,n){if(1&e&&t.Gf(I,7),2&e){let i;t.iGM(i=t.CRH())&&(n._editorContainer=i.first)}},standalone:!0,features:[t.jDz],decls:12,vars:4,consts:[[1,"flex","flex-col","h-screen"],[1,"flex","p-4","shadow","md:shadow-lg","justify-between"],[1,"flex","justify-between","items-center","flex-auto"],["class","font-bold ",4,"ngIf"],["class","text-gray-600 text-sm pt-1 mr-2",4,"ngIf"],[1,"bg-brand-primary","px-2","py-1","rounded"],[1,"text-gray-100","text-sm",3,"click"],[1,"flex-auto","overflow-y-auto"],[1,"h-screen","rounded-lg"],["editorContainer",""],[1,"font-bold"],["class","appearance-none shadow md:shadow-lg justify-between",4,"ngIf","ngIfElse"],["noNestedTemplates",""],[1,"appearance-none","shadow","md:shadow-lg","justify-between"],[3,"change"],["class","hover:bg-blue-400",3,"value",4,"ngFor","ngForOf"],[1,"hover:bg-blue-400",3,"value"],[1,"text-gray-600","text-sm","pt-1","mr-2"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t.YNc(3,O,5,4,"div",3),t.ALo(4,"async"),t.YNc(5,J,2,0,"div",4),t.qZA(),t.TgZ(6,"div",5)(7,"button",6),t.NdJ("click",function(){return n.saveTemplate()}),t._uU(8,"Save"),t.qZA()()(),t.TgZ(9,"div",7),t._UZ(10,"div",8,9),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("ngIf",t.lcZ(4,2,n.selectedFileName$)),t.xp6(2),t.Q6J("ngIf",n.showSaved))},dependencies:[d.Ov,d.O5,d.sg,T.Su],encapsulation:2}),o})();const Y=g}}]);